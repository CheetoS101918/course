import pandas as pd
import json

with open('../task1/sebestoimost_structure.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# --- Создание DataFrame из JSON ---
df_seb = pd.DataFrame(data)

# --- Извлечение данных ---
# 1. Расходы основных материалов на годовой выпуск (тыс.руб.)
C_om_A = df_seb.loc[df_seb['Наименование статей расходов'] == '1. Основные материалы за вычетом возвратных отходов', 'Изделие А на годовой выпуск, тыс.руб.'].iloc[0] # 1296.78
C_om_B = df_seb.loc[df_seb['Наименование статей расходов'] == '1. Основные материалы за вычетом возвратных отходов', 'Изделие Б на годовой выпуск, тыс.руб.'].iloc[0] # 413.15

# 2. Расходы покупных полуфабрикатов и комплектующих на годовой выпуск (тыс.руб.)
C_pok_A = df_seb.loc[df_seb['Наименование статей расходов'] == '2. Покупные полуфабрикаты и комплектующие изделия', 'Изделие А на годовой выпуск, тыс.руб.'].iloc[0] # 17361.73
C_pok_B = df_seb.loc[df_seb['Наименование статей расходов'] == '2. Покупные полуфабрикаты и комплектующие изделия', 'Изделие Б на годовой выпуск, тыс.руб.'].iloc[0] # 10478.94

# 3. Производственная себестоимость одного изделия (руб.)
C_A = df_seb.loc[df_seb['Наименование статей расходов'] == 'ВСЕГО производственная себестоимость', 'Изделие А на единицу, руб'].iloc[0] # 346452.67
C_B = df_seb.loc[df_seb['Наименование статей расходов'] == 'ВСЕГО производственная себестоимость', 'Изделие Б на единицу, руб'].iloc[0] # 191627.72

# 4. Ср - производственная себестоимость годового выпуска продукции относительно этого изделия, тыс. руб.
Cp_A = df_seb.loc[df_seb['Наименование статей расходов'] == 'ВСЕГО производственная себестоимость', 'Изделие А на годовой выпуск, тыс.руб.'].iloc[0]
Cp_B = df_seb.loc[df_seb['Наименование статей расходов'] == 'ВСЕГО производственная себестоимость', 'Изделие Б на годовой выпуск, тыс.руб.'].iloc[0]

# 5. Начальные материальные расходы (сумма расходов по первым двум статьям калькуляции) для ЕДИНИЦЫ ИЗДЕЛИЯ (руб.)
C_m_A = df_seb.loc[df_seb['Наименование статей расходов'] == '1. Основные материалы за вычетом возвратных отходов', 'Изделие А на единицу, руб'].iloc[0] + \
        df_seb.loc[df_seb['Наименование статей расходов'] == '2. Покупные полуфабрикаты и комплектующие изделия', 'Изделие А на единицу, руб'].iloc[0] # 12839.44 + 171898.36 = 184737.8

C_m_B = df_seb.loc[df_seb['Наименование статей расходов'] == '1. Основные материалы за вычетом возвратных отходов', 'Изделие Б на единицу, руб'].iloc[0] + \
        df_seb.loc[df_seb['Наименование статей расходов'] == '2. Покупные полуфабрикаты и комплектующие изделия', 'Изделие Б на единицу, руб'].iloc[0] # 6166.45 + 156402.14 = 162568.59

# Вывод для проверки
print(f"C_om_A (годовой выпуск): {C_om_A}")
print(f"C_om_B (годовой выпуск): {C_om_B}")
print(f"C_pok_A (годовой выпуск): {C_pok_A}")
print(f"C_pok_B (годовой выпуск): {C_pok_B}")
print(f"C_A (ед.изд.): {C_A}")
print(f"C_B (ед.изд.): {C_B}")
print(Cp_A)
print(Cp_B)
print(f"C_m_A (ед.изд.): {C_m_A}")
print(f"C_m_B (ед.изд.): {C_m_B}")

individual_volumes_json_filename = "../task1/individual_product_volumes.json"
with open(individual_volumes_json_filename, 'r', encoding='utf-8') as f:
    data2 = json.load(f)

df2 = pd.DataFrame(data2)

# Изделие А
Q_A = df2.loc[df2['Изделие'] == 'А', 'Объем_товарной_продукции_по_изделию тыс руб'].iloc[0]
#C_om_A = 1309.62  # тыс.руб (Расходы основных материалов на годовой выпуск)
#C_pok_A = 17533.63  # тыс.руб (Расходы покупных полуфабрикатов и комплектующих на годовой выпуск)
C_vm_A = 2000  # тыс. руб (Годовые расходы вспомогательных материалов)
N_om_A = 12  # дн (Норма запаса основных материалов)
N_pok_A = 6  # дн (Норма запаса покупных полуфабрикатов и комплектующих)
N_vm_A = 11  # дн (Норма запаса вспомогательных материалов)
OS_prz_A = 800  # тыс.руб (Норматив оборотных средств по прочим производственным запасам)
#C_A = 354805.89  # Руб (Производственная себестоимость одного изделия)
#C_m_A = 184737.80  # Руб (Начальные материальные расходы)
T_c_A = 8  # Дн (Длительность производственного цикла)
N_gp_A = 2  # Дн (Норма запаса готовой продукции)
OS_rbp_A = 700  # тыс.руб (Норматив оборотных средств на расходы будущих периодов)

# Изделие Б
Q_B =  df2.loc[df2['Изделие'] == 'Б', 'Объем_товарной_продукции_по_изделию тыс руб'].iloc[0]
#C_om_B = 419.32  # тыс.руб (Расходы основных материалов на годовой выпуск)
#C_pok_B = 10635.35  # тыс.руб (Расходы покупных полуфабрикатов и комплектующих на годовой выпуск)
C_vm_B = 1300  # тыс. руб (Годовые расходы вспомогательных материалов)
N_om_B = 30  # дн (Норма запаса основных материалов)
N_pok_B = 5  # дн (Норма запаса покупных полуфабрикатов и комплектующих)
N_vm_B = 9  # дн (Норма запаса вспомогательных материалов)
OS_prz_B = 900  # тыс.руб (Норматив оборотных средств по прочим производственным запасам)
#C_B = 193053.24  # Руб (Производственная себестоимость одного изделия)
#C_m_B = 162568.59  # Руб (Начальные материальные расходы)
T_c_B = 9  # Дн (Длительность производственного цикла)
N_gp_B = 3  # Дн (Норма запаса готовой продукции)
OS_rbp_B = 890  # тыс.руб (Норматив оборотных средств на расходы будущих периодов)

# --- Вывод расчётов в консоль ---
print("Изделие А")
OS_om_A_calc = (C_om_A * N_om_A) / 360
print(f"ОСом = (C_om_A * N_om_A) / 360 = ({C_om_A} * {N_om_A}) / 360 = {OS_om_A_calc:.3f} тыс.руб.")
OS_pok_A_calc = (C_pok_A * N_pok_A) / 360
print(f"ОСпок = (C_pok_A * N_pok_A) / 360 = ({C_pok_A} * {N_pok_A}) / 360 = {OS_pok_A_calc:.3f} тыс.руб.")
OS_vm_A_calc = (C_vm_A * N_vm_A) / 360
print(f"ОСвм = (C_vm_A * N_vm_A) / 360 = ({C_vm_A} * {N_vm_A}) / 360 = {OS_vm_A_calc:.3f} тыс.руб.")

print("\nИзделие Б")
OS_om_B_calc = (C_om_B * N_om_B) / 360
print(f"ОСом = (C_om_B * N_om_B) / 360 = ({C_om_B} * {N_om_B}) / 360 = {OS_om_B_calc:.3f} тыс.руб.")
OS_pok_B_calc = (C_pok_B * N_pok_B) / 360
print(f"ОСпок = (C_pok_B * N_pok_B) / 360 = ({C_pok_B} * {N_pok_B}) / 360 = {OS_pok_B_calc:.3f} тыс.руб.")
OS_vm_B_calc = (C_vm_B * N_vm_B) / 360
print(f"ОСвм = (C_vm_B * N_vm_B) / 360 = ({C_vm_B} * {N_vm_B}) / 360 = {OS_vm_B_calc:.3f} тыс.руб.")

# --- Основные расчёты ---
# Изделие А
OS_pz_A = OS_om_A_calc + OS_pok_A_calc + OS_vm_A_calc + OS_prz_A
K_nz_A = (C_m_A + 0.5 * (C_A - C_m_A)) / C_A
OS_np_A = (Cp_A * T_c_A * K_nz_A) / 360 ##########
OS_gp_A = (Q_A * N_gp_A) / 360

# Изделие Б
OS_pz_B = OS_om_B_calc + OS_pok_B_calc + OS_vm_B_calc + OS_prz_B
K_nz_B = (C_m_B + 0.5 * (C_B - C_m_B)) / C_B
OS_np_B = (Cp_B * T_c_B * K_nz_B) / 360 ##############
OS_gp_B = (Q_B * N_gp_B) / 360

# Итоги
OS_pz_total = OS_pz_A + OS_pz_B
OS_np_total = OS_np_A + OS_np_B
OS_rbp_total = OS_rbp_A + OS_rbp_B
OS_gp_total = OS_gp_A + OS_gp_B
OS_total = OS_pz_total + OS_np_total + OS_rbp_total + OS_gp_total

print(f"\nОбщий норматив оборотных средств в производственных запасах:")
print(f"ОСпз = ОСом + ОСпок + ОСвм + ОСпрз. (1.14)")
print(f"Изделие А: ОСпз = {OS_om_A_calc:.3f} + {OS_pok_A_calc:.3f} + {OS_vm_A_calc:.3f} + {OS_prz_A} = {OS_pz_A:.3f} тыс.руб.")
print(f"Изделие Б: ОСпз = {OS_om_B_calc:.3f} + {OS_pok_B_calc:.3f} + {OS_vm_B_calc:.3f} + {OS_prz_B} = {OS_pz_B:.3f} тыс.руб.")

print(f"\nСуммарный норматив оборотных средств производственных запасов для изделий А и Б:")
print(f"ОСосп.А.Б = ОСпзА + ОСпзБ = {OS_pz_A:.3f} + {OS_pz_B:.3f} = {OS_pz_total:.3f} тыс.руб.")


print(f"\nНорматив оборотных средств в незавершенном производстве:")
# Изделие А
print(f"Коэффициент нарастания затрат для изделия А:")
print(f"Кнз = (C_m_A + 0.5*(C_A - C_m_A)) / C_A = ({C_m_A} + 0.5*({C_A} - {C_m_A})) / {C_A} = {K_nz_A:.3f}")
#OS_np_A = (Q_A / 360) * T_c_A * K_nz_A
print(f"ОСнп = (Q_A / 360) * T_c_A * Kнз = ({Q_A} / 360) * {T_c_A} * {K_nz_A:.3f} = {OS_np_A:.2f} тыс.руб.")
# Изделие Б
print(f"\nКоэффициент нарастания затрат для изделия Б:")
print(f"Кнз = (C_m_B + 0.5*(C_B - C_m_B)) / C_B = ({C_m_B} + 0.5*({C_B} - {C_m_B})) / {C_B} = {K_nz_B:.3f}")
#OS_np_B = (Q_B / 360) * T_c_B * K_nz_B
print(f"ОСнп = (Q_B / 360) * T_c_B * Kнз = ({Q_B} / 360) * {T_c_B} * {K_nz_B:.3f} = {OS_np_B:.2f} тыс.руб.")

print(f"\nСуммарный норматив оборотных средств по незавершенному производству:")
print(f"ОСнз = ОСнза + ОСнзб = {OS_np_A:.2f} + {OS_np_B:.2f} = {OS_np_total:.2f} тыс.руб.")


print(f"\nСуммарный норматив оборотных средств на расходы будущих периодов:")
print(f"ОСрпб = ОСрпбА + ОСрпбБ = {OS_rbp_A:.2f} + {OS_rbp_B:.2f} = {OS_rbp_total:.2f} тыс.руб.")


print(f"\nНорматив оборотных средств в готовой продукции:")
print(f"Изделие А: ОСгп = (C_A * N_gp_A) / 360 = ({Q_A} * {N_gp_A}) / 360 = {OS_gp_A:.2f} тыс.руб.")
print(f"Изделие Б: ОСгп = (C_B * N_gp_B) / 360 = ({Q_B} * {N_gp_B}) / 360 = {OS_gp_B:.2f} тыс.руб.")

print(f"\nСуммарный норматив оборотных средств в запасах готовой продукции для изделий А и Б:")
print(f"ОСгп = ОСгпА + ОСгпБ = {OS_gp_A:.2f} + {OS_gp_B:.2f} = {OS_gp_total:.2f} тыс.руб.")


print(f"\nСуммарный норматив оборотных средств (ОС) определяется по формуле:")
print(f"ОС = ОСпз + ОСнп + ОСгп + ОСрбп. (2.9)")
print(f"ОС = {OS_pz_total:.3f} + {OS_np_total:.2f} + {OS_gp_total:.2f} + {OS_rbp_total} = {OS_total:.2f} тыс.руб.")

# --- Создание таблиц в формате CSV ---

# Таблица 1: Исходные данные для определения норматива оборотных средств
data_input = {
    '№': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
    'Показатели': [
        'Годовой объем товарной продукции',
        'Расходы основных материалов на годовой выпуск',
        'Расходы покупных полуфабрикатов и комплектующих на годовой выпуск',
        'Годовые расходы вспомогательных материалов',
        'Норма запаса основных материалов',
        'Норма запаса покупных полуфабрикатов и комплектующих',
        'Норма запаса вспомогательных материалов',
        'Норматив оборотных средств по прочим производственным запасам',
        'Производственная себестоимость одного изделия',
        'Начальные материальные расходы (сумма расходов по первым двум статьям калькуляции)',
        'Длительность производственного цикла',
        'Норма запаса готовой продукции',
        'Норматив оборотных средств на расходы будущих периодов'
    ],
    'Един. измерения': ['тыс.руб.', 'тыс.руб.', 'тыс.руб.', 'тыс.руб.', 'Дн', 'Дн', 'Дн', 'тыс.руб.', 'Руб', 'Руб', 'Дн', 'Дн', 'тыс.руб.'],
    'Условные обозначения': ['Qт', 'Сом', 'Спок', 'Свм', 'Ном', 'Нпок', 'Нвм', 'ОСпрз', 'С', 'См', 'Тц', 'Нгп', 'ОСрбп'],
    'А': [Q_A, C_om_A, C_pok_A, C_vm_A, N_om_A, N_pok_A, N_vm_A, OS_prz_A, C_A, C_m_A, T_c_A, N_gp_A, OS_rbp_A],
    'Б': [Q_B, C_om_B, C_pok_B, C_vm_B, N_om_B, N_pok_B, N_vm_B, OS_prz_B, C_B, C_m_B, T_c_B, N_gp_B, OS_rbp_B]
}

df_input = pd.DataFrame(data_input)
df_input.to_csv('Таблица_1_Исходные_данные_норматив_оборотных_средств.csv', index=False, encoding='utf-8-sig')

# Таблица 2: Сводный расчет норматива оборотных средств
for_a = [OS_pz_A, OS_np_A, OS_rbp_A, OS_gp_A]
for_b = [OS_pz_B, OS_np_B, OS_rbp_B, OS_gp_B]
data_summary = {
    '№': [1, 2, 3, 4, 5],
    'Наименование элементов оборотных средств': [
        'Производственные запасы',
        'Незавершенное производство',
        'Расходы будущих периодов',
        'Готовая продукция',
        'Всего'
    ],
    'Условные обозначения': ['ОСпз', 'ОСнп', 'ОСрбп', 'ОСгп', ''],
    'Изделие А, тыс. руб': for_a + [sum(for_a)],
    'Изделие Б, тыс. руб': for_b + [sum(for_b)],
    'Сумма, тыс. руб': [OS_pz_total, OS_np_total, OS_rbp_total, OS_gp_total, OS_total],
    'В % всего': [
        (OS_pz_total / OS_total) * 100,
        (OS_np_total / OS_total) * 100,
        (OS_rbp_total / OS_total) * 100,
        (OS_gp_total / OS_total) * 100,
        100
    ]
}
df_summary = pd.DataFrame(data_summary).round(2)
df_summary.to_csv('Таблица_2_Сводный_расчет_норматива_оборотных_средств.csv', index=False, encoding='utf-8-sig', sep=';')

